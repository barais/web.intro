import{d as W,t as d,N as I,O as U,Q as V,o as x,c as $,v as F,z as k,ai as u,ac as Q,b as Z,l as M,B as C,aw as K,i as X,h as Y}from"../modules/vue-CHNgrS5A.js";import{a as ee,a4 as te,a5 as ae,z as c,d as m,L as b,a2 as P,a6 as w,a7 as se,a8 as ne,a9 as oe,aa as re,ab as ie,ac as le,B as ce,_ as ue}from"../index-CC0CoKEQ.js";import{u as z}from"./context-SSO1HXeM.js";import{H as de}from"../hashids-CTCUm3b4.js";const pe=W({__name:"WsSynchro",setup(v){z();const{clicksContext:o,currentSlideNo:l,hasPrimarySlide:h,isNotesViewer:N,isPresenter:r}=ee();let s;const i=d(1),p=d(""),S=d(1),g=d(0),f=I();function B(e){return b.value.find(t=>t.no===+e||t.meta.slide.frontmatter.routeAlias===e)}function O(e,t){(typeof e=="number"||typeof e=="string")&&(e=B(e));const a=e.meta.slide.frontmatter.routeAlias??e.no;return t?`/presenter/${a}`:`/${a}`}function R(){if(r.value)s.send(JSON.stringify({id:p.value,state:m,type:"broadcast",mtype:"slide"}));else return}f.afterEach(R),te(e=>{r.value&&i.value===0&&(E()?s.send(JSON.stringify({id:p.value,state:e,type:"broadcast",mtype:"slide"})):(delete e.cursor,(S.value!==e.page||g.value!==e.clicks)&&(s.send(JSON.stringify({id:p.value,state:e,type:"broadcast",mtype:"slide"})),S.value=e.page,g.value=e.clicks)))}),ae(e=>{console.error("on patch draw",e),r.value&&i.value==0});function q(){var e;return(e=c.wsSettings)!=null&&e.server?c.wsSettings.server.endsWith("/")?c.wsSettings.server.slice(0,-1):c.wsSettings.server:"ws://localhost:8080"}function E(){var e;return((e=c.wsSettings)==null?void 0:e.updateCursor)!==void 0?c.wsSettings.updateCursor:!1}function J(e){const{state:t,mtype:a,type:n}=JSON.parse(e.data);a==="slide"&&(m.page!==t.page&&(P.value=!1,f.replace({path:O(t.page,r.value),query:{...f.currentRoute.value.query,clicks:t.clicks||0}}),w("page",t.page)),m.clicks!==t.clicks&&(P.value=!1,f.replace({path:O(t.page,r.value),query:{...f.currentRoute.value.query,clicks:t.clicks||0}}),w("clicks",t.clicks)),t.cursor&&w("cursor",t.cursor))}function L(){s?j():(s=new WebSocket(q()),s.addEventListener("message",J),s.addEventListener("open",j),s.addEventListener("close",A))}function T(){s?(i.value=1,s.close()):i.value=1}function j(){i.value=0,s.send(JSON.stringify({id:p.value,type:"connect"}))}function A(){i.value===3?i.value=2:i.value=1}function G(e,t=0){let a=3735928559^t,n=1103547991^t;for(let y=0,_;y<e.length;y++)_=e.charCodeAt(y),a=Math.imul(a^_,2654435761),n=Math.imul(n^_,1597334677);return a=Math.imul(a^a>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),4294967296*(2097151&n)+(a>>>0)}const H=new de;function D(){const e=b.value.map(a=>{var n;return((n=a==null?void 0:a.meta)==null?void 0:n.slide).content??""}).join(`
`),t=b.value[0].meta.slide.title;return H.encode(G(t+e))}return U(()=>{p.value=D(),r.value&&(S.value=m.page,g.value=m.clicks),L()}),V(()=>{T()}),(e,t)=>null}}),fe={__name:"global-bottom",setup(v){return z(),(o,l)=>{const h=pe;return x(),$(h)}}},Ce={render:()=>[]},be={render:()=>[F(fe)]},me={render:()=>[]},ve={render:()=>[]},he=["data-slidev-no"],Se=W({__name:"SlideWrapper",props:{clicksContext:{type:Object,required:!0},renderContext:{type:String,default:"slide"},route:{type:Object,required:!0}},setup(v){const o=v,l=k(()=>{var r,s;return((s=(r=o.route.meta)==null?void 0:r.slide)==null?void 0:s.frontmatter.zoom)??1});u(se,o.route),u(ne,o.route.meta.slide.frontmatter),u(oe,d(o.route.no)),u(re,d(o.renderContext)),u(ie,Q(o,"clicksContext")),u(le,l);const h=k(()=>l.value===1?void 0:{width:`${100/l.value}%`,height:`${100/l.value}%`,transformOrigin:"top left",transform:`scale(${l.value})`}),N=k(()=>({...h.value,"user-select":c.selectable?void 0:"none"}));return(r,s)=>(x(),Z("div",{"data-slidev-no":o.route.no,class:X(C(ce)(v.route,["slide","presenter"].includes(o.renderContext)?"":"disable-view-transition")),style:Y(N.value)},[M(C(ve)),(x(),$(K(o.route.component))),M(C(me))],14,he))}}),we=ue(Se,[["__scopeId","data-v-9622c723"]]);export{be as G,we as S,Ce as a};
