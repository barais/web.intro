import{a as v,c as t,C as n,g as s}from"./server-202a9KlH.js";import{d as o,f,p as c,a as S}from"./helper-CV-OkBcW.js";import"./modules/vue-rRtXEXxZ.js";import"./index-Dszz-33r.js";import"./modules/shiki-B49DkA4F.js";import"./hashids-CTCUm3b4.js";let i,p;const u=f();function O(e){const a=JSON.parse(e.data);Object.entries(a).forEach(([l,r])=>c[l]=r)}function E(e){const a=JSON.parse(e.data);Object.entries(a).forEach(([l,r])=>S[l]=r)}function d(){s.value&&(fetch(`${u}/connect?uid=${o.value}`,{body:JSON.stringify({id:s.value,state:c}),method:"POST",headers:{"content-type":"application/json"}}),t.value=n.CONNECTED,p())}function N(){t.value===n.IDLE?t.value=n.ERROR:t.value=n.DISCONNECTED}function h(){i?d():(i=new EventSource(`${u}/event?uid=${o.value}`),i.addEventListener("poll",O),i.addEventListener("user",E),i.addEventListener("open",d),i.addEventListener("error",N))}function I(e){v.value=new Date().toISOString(),h(),p=e}function D(e,a){t.value===n.CONNECTED&&fetch(`${u}/status?uid=${o.value}`,{body:JSON.stringify({id:s.value,pollId:e,status:a}),method:"POST",headers:{"content-type":"application/json"}})}function b(e){t.value===n.CONNECTED&&fetch(`${u}/reset?uid=${o.value}`,{body:JSON.stringify({id:s.value,pollId:e}),method:"POST",headers:{"content-type":"application/json"}})}function j(e,a){t.value===n.CONNECTED&&fetch(`${u}/answer?uid=${o.value}`,{body:JSON.stringify({id:s.value,pollId:e,result:a,userId:o.value}),method:"POST",headers:{"content-type":"application/json"}})}function J(e){t.value===n.CONNECTED&&fetch(`${u}/login?uid=${o.value}`,{body:JSON.stringify({id:s.value,userId:o.value,userName:e}),method:"POST",headers:{"content-type":"application/json"}})}export{j as answer,I as connect,J as login,b as reset,D as setStatus};
