import{a as f,c as t,C as n,g as s}from"./server-D5r0YahC.js";import{d as a,f as p,p as c,a as S}from"./helper-CbbnnruO.js";import"./modules/vue-CHNgrS5A.js";import"./index-KJZsuQFl.js";import"./modules/shiki-B4CAAHVZ.js";let i,v;const u=p();function O(e){const o=JSON.parse(e.data);Object.entries(o).forEach(([l,r])=>c[l]=r)}function E(e){const o=JSON.parse(e.data);Object.entries(o).forEach(([l,r])=>S[l]=r)}function d(){s.value&&(fetch(`${u}/connect?uid=${a.value}`,{body:JSON.stringify({id:s.value,state:c}),method:"POST",headers:{"content-type":"application/json"}}),t.value=n.CONNECTED,v())}function N(){t.value===n.IDLE?t.value=n.ERROR:t.value=n.DISCONNECTED}function h(){i?d():(i=new EventSource(`${u}/event?uid=${a.value}`),i.addEventListener("poll",O),i.addEventListener("user",E),i.addEventListener("open",d),i.addEventListener("error",N))}function T(e){f.value=new Date().toISOString(),h(),v=e}function I(e,o){t.value===n.CONNECTED&&fetch(`${u}/status?uid=${a.value}`,{body:JSON.stringify({id:s.value,pollId:e,status:o}),method:"POST",headers:{"content-type":"application/json"}})}function D(e){t.value===n.CONNECTED&&fetch(`${u}/reset?uid=${a.value}`,{body:JSON.stringify({id:s.value,pollId:e}),method:"POST",headers:{"content-type":"application/json"}})}function b(e,o){t.value===n.CONNECTED&&fetch(`${u}/answer?uid=${a.value}`,{body:JSON.stringify({id:s.value,pollId:e,result:o,userId:a.value}),method:"POST",headers:{"content-type":"application/json"}})}function j(e){t.value===n.CONNECTED&&fetch(`${u}/login?uid=${a.value}`,{body:JSON.stringify({id:s.value,userId:a.value,userName:e}),method:"POST",headers:{"content-type":"application/json"}})}export{b as answer,T as connect,j as login,D as reset,I as setStatus};
